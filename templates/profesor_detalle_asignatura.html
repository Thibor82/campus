{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2>{{ asignatura[1] }}</h2>
    <p class="text-muted">Gestionando asignatura</p>

    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="alumnos-tab" data-bs-toggle="tab" data-bs-target="#alumnos" type="button">Alumnos</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="eventos-tab" data-bs-toggle="tab" data-bs-target="#eventos" type="button">Eventos</button>
        </li>
    </ul>

    <div class="tab-content">
        <!-- Tab Alumnos -->
        <div class="tab-pane fade show active" id="alumnos">
            {% if alumnos %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Usuario</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for id_alumno, usuario, email in alumnos %}
                            <tr>
                                <td>{{ usuario }}</td>
                                <td>{{ email }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <p class="text-muted"><strong>Total:</strong> {{ alumnos|length }} alumnos</p>
            {% else %}
                <div class="alert alert-info">
                    No hay alumnos matriculados aún.
                </div>
            {% endif %}
        </div>

        <!-- Tab Eventos -->
        <div class="tab-pane fade" id="eventos">
            <h5 class="mb-4">Crear Evento</h5>
            <form method="POST" action="{{ url_for('profesor_bp.crear_evento', id_asignatura=asignatura[0]) }}" class="mb-5">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="fecha" class="form-label">Fecha</label>
                        <input type="date" class="form-control" id="fecha" name="fecha" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="titulo" class="form-label">Título</label>
                    <input type="text" class="form-control" id="titulo" name="titulo" required>
                </div>
                <div class="mb-3">
                    <label for="descripcion" class="form-label">Descripción</label>
                    <textarea class="form-control" id="descripcion" name="descripcion" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Crear Evento</button>
            </form>

            <h5 class="mb-3">Eventos Creados</h5>
            {% if eventos %}
                <div class="list-group">
                    {% for id_evento, fecha, titulo, descripcion in eventos %}
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ titulo }}</h6>
                                <p class="mb-1 text-muted"><strong>{{ fecha }}</strong></p>
                                {% if descripcion %}
                                    <p class="mb-1">{{ descripcion }}</p>
                                {% endif %}
                            </div>
                            <form method="POST" action="{{ url_for('profesor_bp.eliminar_evento', id_evento=id_evento) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('¿Eliminar evento?')">Eliminar</button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    No hay eventos creados.
                </div>
            {% endif %}
        </div>
    </div>

    <a href="{{ url_for('profesor_bp.mis_asignaturas') }}" class="btn btn-secondary mt-4">Volver</a>
</div>
{% endblock %}
